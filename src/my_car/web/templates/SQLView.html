{% extends "layout.html" %}
{% block content %}
 <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
 <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
 <script type="text/javascript" src="{{ url_for('static', filename='js/index.js')}}"></script>

 <style>
  .btn-delete {
    padding: 0.005rem 0.35rem;
    font-size: .8rem;
    line-height: 0.005;
    border-radius: .2rem;
    color: #ffffff;  /* Set the text color to white */
  }
  #main {
    background-color: #ADD8E6;
  }
  </style>
<!-- 在HTML中添加下拉式表單 -->
<!-- <select id="areaSelect" onchange="updateCharts()">
  <option value="A1">Area A1</option>
  <option value="A2">Area A2</option>
</select> -->

<div id="tablePage" style="max-width:100%; overflow:auto; margin:50px 0 0 0; ">
      <table id="example" class="table table-striped table-bordered" style="width:100%;">
        <thead>
          <tr>
            <td width="8%" align="center">No</td>
            <td width="12%" align="center">Area</td>
            <td width="15%" align="center">Temperture (&#176;C)</td>
            <td width="15%" align="center">Humidity (%)</td>
            <td width="15%" align="center">CO2 (ppm)</td>
            <td width="20%" align="center">Time</td>
            <td width="15%" align="center">Action</td>
          </tr>
        </thead>
        <tbody>
          {% for row in list_users %}
          <tr>
            <td align="center">{{row[0]}}</td> <!-- record_no -->
            <td align="center">{{row[1]}}</td> <!-- Position -->
            <td align="center">{{row[2]}}</td> <!-- Temperture -->
            <td align="center">{{row[3]}}</td> <!-- Humidity -->
            <td align="center">{{row[4]}}</td> <!-- CO2 -->
            <td align="center">{{row[5]}}</td> <!-- Time -->
            <td align="center">
              <a href="/edit/{{row[0]}}" class="btn btn-secondary btn-sm">edit</a>
              <!-- <a href="/delete/{{row[0]}}" class="btn btn-danger btn-delete btn-sm">delete</a> -->
              <!-- <form method="POST" action="/delete/{{row[0]}}">
                <button type="submit" class="btn btn-danger btn-delete btn-sm">delete</button>
              </form> -->
              <!-- <div class="button-container">
                <form method="POST" action="/edit/{{row[0]}}" style="display: inline;">
                  <button type="submit" class="btn btn-secondary btn-sm">edit</button>
                </form> -->
                <form method="POST" action="/delete/{{row[0]}}" style="display: inline;" onsubmit="return confirm('確定要刪除嗎？');">
                  <button type="submit" class="btn btn-danger btn-delete btn-delete">delete</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
</div>
<!-- <div class="command-bar">
  <img id="refreshButton" src="/static/img/refresh_icon.png" alt="刷新表格" 
  style="cursor: pointer; width: 50px; height: 50px;position: absolute; top: 0; right: 0;">
  <table id="example" class="table table-striped table-bordered" style="width:100%;">
</table>
</div> -->

<div style="display: flex; justify-content: space-between;">
  <div>
    <h3>Temperture</h3>
    <canvas id="myChart1" width="400" height="400"></canvas>
  </div>
  <div>
    <h3>Humidity</h3>
    <canvas id="myChart2" width="400" height="400"></canvas>
  </div>
  <div>
    <h3>CO2</h3>
    <canvas id="myChart3" width="400" height="400"></canvas>
  </div>
</div>



<!-- <script>
$('#refreshButton').click(function() {
    $.ajax({
        url: '/get_table_data',
        type: 'GET',
        success: function(data) {
            // 清空表格的當前內容
            $('#example tbody').empty();

            // 使用返回的資料來填充表格
            $.each(data, function(i, item) {
                var row = '<tr>' +
                    '<td align="center">' + item.record_no + '</td>' +
                    '<td align="center">' + item.area + '</td>' +
                    '<td align="center">' + item.temperature + '</td>' +
                    '<td align="center">' + item.humidity + '</td>' +
                    '<td align="center">' + item.co2 + '</td>' +
                    '<td align="center">' + item.time + '</td>' +
                    '<td align="center">' +
                    '<a href="/edit/' + item.record_no + '" class="btn btn-secondary btn-sm">edit</a>' +
                    '<form method="POST" action="/delete/' + item.record_no + '" style="display: inline;" onsubmit="return confirm(\'確定要刪除嗎？\');">' +
                    '<button type="submit" class="btn btn-danger btn-delete btn-delete">delete</button>' +
                    '</form>' +
                    '</td>' +
                    '</tr>';
                $('#example tbody').append(row);
            });
        }
    });
});

  </script> -->
<!-- <div>
  <canvas id="myChart"></canvas>
</div> -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- <script>
  const ctx = document.getElementById('myChart');
  
  var IoTdata = {{list_users | tojson}};
  var A0val = [];
  var A0time = [];
  for (var i=0; i<IoTdata.length; i++){
    if (IoTdata[i][1] == 'A1'){
      A0val.push(IoTdata[i][2]);
      A0time.push(IoTdata[i][5]);
    }
  }
  const labels = A0time;
  const data = {
    labels: labels,
    datasets: [{
      label: 'My First Dataset',
      data: A0val,
      fill: false,
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.1
    }]
  };
  new Chart(ctx, {
    type: 'line',
    data: data,
    options: {
      scales: {
        y: {
          min: 23,
          max: 35
        }
      }
    }
  });

$(document).ready(function() {
    $('#example').DataTable({     
      "aLengthMenu": [[3, 5, 10, 25, -1], [3, 5, 10, 25, "All"]],
        "iDisplayLength": 3
       } 
    );
} );
</script> -->
<script>
  var IoTdata = {{list_users | tojson}};
  var A0val = [];
  var A1val = [];
  var A2val = [];
  var A0time = [];
  for (var i=0; i<IoTdata.length; i++){
    if (IoTdata[i][1] == 'A1'){
      A0val.push(IoTdata[i][2]);  // Temperture
      A1val.push(IoTdata[i][3]);  // Humidity
      A2val.push(IoTdata[i][4]);  // CO2
      A0time.push(IoTdata[i][5]);
    }
  }
  const labels = A0time;

  // 找出 A0val, A1val, A2val 的最大值和最小值
  var A0min = Math.min(...A0val);
  var A0max = Math.max(...A0val);
  var A1min = Math.min(...A1val);
  var A1max = Math.max(...A1val);
  var A2min = Math.min(...A2val);
  var A2max = Math.max(...A2val);

  // Temperture Chart
  const ctx1 = document.getElementById('myChart1');
  const data1 = {
    labels: labels,
    datasets: [{
      label: 'Temperture',
      data: A0val,
      fill: false,
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.1
    }]
  };
  new Chart(ctx1, {
    type: 'line',
    data: data1,
    options: {
      scales: {
        y: {
          min: A0min,
          max: A0max
        }
      }
    }
  });

  // Humidity Chart
  const ctx2 = document.getElementById('myChart2');
  const data2 = {
    labels: labels,
    datasets: [{
      label: 'Humidity',
      data: A1val,
      fill: false,
      borderColor: 'rgb(255, 0, 0)',
      tension: 0.1
    }]
  };
  new Chart(ctx2, {
    type: 'line',
    data: data2,
    options: {
      scales: {
        y: {
          min: A1min,
          max: A1max
        }
      }
    }
  });

  // CO2 Chart
  const ctx3 = document.getElementById('myChart3');
  const data3 = {
    labels: labels,
    datasets: [{
      label: 'CO2',
      data: A2val,
      fill: false,
      borderColor: 'rgb(0, 0, 255)',
      tension: 0.1
    }]
  };
  new Chart(ctx3, {
    type: 'line',
    data: data3,
    options: {
      scales: {
        y: {
          min: A2min,
          max: A2max
        }
      }
    }
  });
  // 在JavaScript中添加函數來更新圖表
  // function updateCharts() {
  //   var selectElement = document.getElementById('areaSelect');
  //   var selectedArea = selectElement.value;

    // 根據選擇的區域更新資料
  //   var A0val = [];
  //   var A1val = [];
  //   var A2val = [];
  //   var A0time = [];
  //   for (var i=0; i<IoTdata.length; i++){
  //     if (IoTdata[i][1] == selectedArea){
  //       A0val.push(IoTdata[i][2]);  // Temperture
  //       A1val.push(IoTdata[i][3]);  // Humidity
  //       A2val.push(IoTdata[i][4]);  // CO2
  //       A0time.push(IoTdata[i][5]);
  //     }
  //   }

  //   // 更新圖表的資料
  //   data1.datasets[0].data = A0val;
  //   data2.datasets[0].data = A1val;
  //   data3.datasets[0].data = A2val;

  //   // 更新圖表的標籤
  //   data1.labels = A0time;
  //   data2.labels = A0time;
  //   data3.labels = A0time;

  //   // 重新渲染圖表
  //   myChart1.update();
  //   myChart2.update();
  //   myChart3.update();
  // }
$(document).ready(function() {
    $('#example').DataTable({     
      "aLengthMenu": [[3, 5, 10, 25, -1], [3, 5, 10, 25, "All"]],
        "iDisplayLength": 3
       } 
    );
} );
// 建立下拉式選單
// var select = $('<select><option value=""></option></select>')
//         .appendTo( $(table.column(1).header()).empty() )
//         .on( 'change', function () {
//             var val = $.fn.dataTable.util.escapeRegex(
//                 $(this).val()
//             );
//             table.column(1)
//                 .search( val ? '^'+val+'$' : '', true, false )
//                 .draw();
//             updateCharts(val);  // 更新圖表
//         } );

//     // 為下拉式選單添加選項
//     table.column(1).data().unique().sort().each( function ( d, j ) {
//         select.append( '<option value="'+d+'">'+d+'</option>' )
//     } );
</script>


<!--<script type="text/javascript" src="{{ url_for('static', filename='assets/js/jquery.min.js')}}"></script>-->
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/browser.min.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/breakpoints.min.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/util.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/main.js')}}"></script>
{% endblock %}
