{% extends "layout.html" %}
{% block content %}
 <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
 <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
 <script type="text/javascript" src="{{ url_for('static', filename='js/index.js')}}"></script>

 <style>
  .btn-delete {
    padding: 0.005rem 0.35rem;
    font-size: .8rem;
    line-height: 0.005;
    border-radius: .2rem;
    color: #ffffff;  /* Set the text color to white */
  }
  </style>

<div style="margin:50px 0 0 0; ">
      <table id="example" class="table table-striped table-bordered" style="width:100%;">
        <thead>
          <tr>
            <td width="8%" align="center">No</td>
            <td width="12%" align="center">Area</td>
            <td width="15%" align="center">Temperture (&#176;C)</td>
            <td width="15%" align="center">Humidity (%)</td>
            <td width="15%" align="center">CO2 (ppm)</td>
            <td width="20%" align="center">Time</td>
            <td width="15%" align="center">Action</td>
          </tr>
        </thead>
        <tbody>
          {% for row in list_users %}
          <tr>
            <td align="center">{{row[0]}}</td> <!-- record_no -->
            <td align="center">{{row[1]}}</td> <!-- Position -->
            <td align="center">{{row[2]}}</td> <!-- Temperture -->
            <td align="center">{{row[3]}}</td> <!-- Humidity -->
            <td align="center">{{row[4]}}</td> <!-- CO2 -->
            <td align="center">{{row[5]}}</td> <!-- Time -->
            <td align="center">
              <a href="/edit/{{row[0]}}" class="btn btn-secondary btn-sm">edit</a>
              <!-- <a href="/delete/{{row[0]}}" class="btn btn-danger btn-delete btn-sm">delete</a> -->
              <!-- <form method="POST" action="/delete/{{row[0]}}">
                <button type="submit" class="btn btn-danger btn-delete btn-sm">delete</button>
              </form> -->
              <!-- <div class="button-container">
                <form method="POST" action="/edit/{{row[0]}}" style="display: inline;">
                  <button type="submit" class="btn btn-secondary btn-sm">edit</button>
                </form> -->
                <form method="POST" action="/delete/{{row[0]}}" style="display: inline;" onsubmit="return confirm('確定要刪除嗎？');">
                  <button type="submit" class="btn btn-danger btn-delete btn-delete">delete</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
</div>
<div class="command-bar">
  <img id="refreshButton" src="/static/img/refresh_icon.png" alt="刷新表格" 
  style="cursor: pointer; width: 50px; height: 50px;position: absolute; top: 0; right: 0;">
  <!-- 其他指令... -->
  <table id="example" class="table table-striped table-bordered" style="width:100%;">
    <!-- 表格內容... -->
</table>
</div>
<script>
$('#refreshButton').click(function() {
    $.ajax({
        url: '/get_table_data',
        type: 'GET',
        success: function(data) {
            // 清空表格的當前內容
            $('#example tbody').empty();

            // 使用返回的資料來填充表格
            $.each(data, function(i, item) {
                var row = '<tr>' +
                    '<td align="center">' + item.record_no + '</td>' +
                    '<td align="center">' + item.area + '</td>' +
                    '<td align="center">' + item.temperature + '</td>' +
                    '<td align="center">' + item.humidity + '</td>' +
                    '<td align="center">' + item.co2 + '</td>' +
                    '<td align="center">' + item.time + '</td>' +
                    '<td align="center">' +
                    '<a href="/edit/' + item.record_no + '" class="btn btn-secondary btn-sm">edit</a>' +
                    '<form method="POST" action="/delete/' + item.record_no + '" style="display: inline;" onsubmit="return confirm(\'確定要刪除嗎？\');">' +
                    '<button type="submit" class="btn btn-danger btn-delete btn-delete">delete</button>' +
                    '</form>' +
                    '</td>' +
                    '</tr>';
                $('#example tbody').append(row);
            });
        }
    });
});

  </script>
<div>
  <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('myChart');
  
  var IoTdata = {{list_users | tojson}};
  var A0val = [];
  var A0time = [];
  for (var i=0; i<IoTdata.length; i++){
    if (IoTdata[i][1] == 'A0'){
      A0val.push(IoTdata[i][2]);
      A0time.push(IoTdata[i][5]);
    }
  }
  const labels = A0time;
  const data = {
    labels: labels,
    datasets: [{
      label: 'My First Dataset',
      data: A0val,
      fill: false,
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.1
    }]
  };
  new Chart(ctx, {
    type: 'line',
    data: data,
    options: {
      scales: {
        y: {
          min: 23,
          max: 27
        }
      }
    }
  });

$(document).ready(function() {
    $('#example').DataTable({     
      "aLengthMenu": [[3, 5, 10, 25, -1], [3, 5, 10, 25, "All"]],
        "iDisplayLength": 3
       } 
    );
} );
</script>
<!--<script type="text/javascript" src="{{ url_for('static', filename='assets/js/jquery.min.js')}}"></script>-->
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/browser.min.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/breakpoints.min.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/util.js')}}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/main.js')}}"></script>
{% endblock %}
